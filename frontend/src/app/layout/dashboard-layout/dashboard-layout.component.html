<div class="min-h-screen bg-surface-50 flex" (keydown)="onKeyDown($event)">
  <!-- Sidebar -->
  <aside
    [class.w-64]="!sidebarCollapsed()"
    [class.w-20]="sidebarCollapsed()"
    class="fixed inset-y-0 left-0 z-30 bg-white border-r border-neutral-200 transition-all duration-300 flex flex-col"
  >
    <!-- Logo -->
    <div class="h-16 flex items-center justify-between px-4 border-b border-neutral-200">
      @if (!sidebarCollapsed()) {
        <h1 class="text-xl font-bold gradient-text">SaaS Suite</h1>
      } @else {
        <div class="w-8 h-8 rounded-lg bg-primary-600 flex items-center justify-center">
          <span class="text-white font-bold text-sm">S</span>
        </div>
      }
      <button
        (click)="toggleSidebar()"
        class="p-2 rounded-lg hover:bg-neutral-100 transition-colors"
        aria-label="Toggle sidebar"
      >
        <svg
          class="w-5 h-5 text-neutral-600"
          fill="none"
          stroke="currentColor"
          viewBox="0 0 24 24"
        >
          <path
            stroke-linecap="round"
            stroke-linejoin="round"
            stroke-width="2"
            [attr.d]="sidebarCollapsed() ? 'M4 6h16M4 12h16M4 18h16' : 'M6 18L18 6M6 6l12 12'"
          />
        </svg>
      </button>
    </div>

    <!-- Navigation -->
    <nav class="flex-1 overflow-y-auto scrollbar-thin p-4 space-y-1">
      @for (item of menuItems; track item.route) {
        <div>
          <a
            [routerLink]="item.route"
            routerLinkActive="bg-primary-50 text-primary-700 border-primary-200"
            [routerLinkActiveOptions]="{ exact: false }"
            class="flex items-center px-3 py-2.5 rounded-xl text-sm font-medium text-neutral-700 hover:bg-neutral-50 transition-all duration-200 border border-transparent group"
          >
            <!-- Icon -->
            <svg
              class="w-5 h-5 flex-shrink-0"
              [class.mr-3]="!sidebarCollapsed()"
              fill="none"
              stroke="currentColor"
              viewBox="0 0 24 24"
            >
              <path
                stroke-linecap="round"
                stroke-linejoin="round"
                stroke-width="2"
                [attr.d]="item.icon"
              />
            </svg>

            <!-- Label -->
            @if (!sidebarCollapsed()) {
              <span class="flex-1">{{ item.label }}</span>
            }

            <!-- Expand Icon (for items with children) -->
            @if (item.children && item.children.length > 0 && !sidebarCollapsed()) {
              <svg
                class="w-4 h-4 text-neutral-400 group-hover:text-neutral-600"
                fill="none"
                stroke="currentColor"
                viewBox="0 0 24 24"
              >
                <path
                  stroke-linecap="round"
                  stroke-linejoin="round"
                  stroke-width="2"
                  d="M19 9l-7 7-7-7"
                />
              </svg>
            }
          </a>

          <!-- Submenu -->
          @if (item.children && item.children.length > 0 && !sidebarCollapsed()) {
            <div class="ml-4 mt-1 space-y-1">
              @for (child of item.children; track child.route) {
                <a
                  [routerLink]="child.route"
                  routerLinkActive="text-primary-600 font-medium"
                  class="block px-3 py-2 text-xs text-neutral-500 hover:text-neutral-700 rounded-lg hover:bg-neutral-50 transition-colors"
                >
                  {{ child.label }}
                </a>
              }
            </div>
          }
        </div>
      }
    </nav>

    <!-- User Section -->
    <div class="p-4 border-t border-neutral-200">
      <button
        (click)="toggleUserMenu()"
        class="w-full flex items-center px-3 py-2 rounded-xl hover:bg-neutral-50 transition-colors"
      >
        <div class="w-8 h-8 rounded-full bg-gradient-to-br from-primary-500 to-accent-500 flex items-center justify-center flex-shrink-0">
          <span class="text-white text-sm font-medium">U</span>
        </div>
        @if (!sidebarCollapsed()) {
          <div class="ml-3 flex-1 text-left">
            <p class="text-sm font-medium text-neutral-900">User Name</p>
            <p class="text-xs text-neutral-500">Company Name</p>
          </div>
        }
      </button>
    </div>
  </aside>

  <!-- Main Content Area -->
  <div
    [class.ml-64]="!sidebarCollapsed()"
    [class.ml-20]="sidebarCollapsed()"
    class="flex-1 transition-all duration-300"
  >
    <!-- Top Bar -->
    <header class="sticky top-0 z-20 bg-white/80 backdrop-blur-lg border-b border-neutral-200">
      <div class="h-16 flex items-center justify-between px-6">
        <!-- Search (CMD+K) -->
        <button
          (click)="openSearch()"
          class="flex items-center px-4 py-2 w-64 text-left text-sm text-neutral-500 bg-neutral-50 border border-neutral-200 rounded-xl hover:bg-neutral-100 transition-colors focus:outline-none focus:ring-2 focus:ring-primary-500"
        >
          <svg
            class="w-4 h-4 mr-2 text-neutral-400"
            fill="none"
            stroke="currentColor"
            viewBox="0 0 24 24"
          >
            <path
              stroke-linecap="round"
              stroke-linejoin="round"
              stroke-width="2"
              d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"
            />
          </svg>
          <span class="flex-1">Search...</span>
          <kbd class="px-1.5 py-0.5 text-xs font-semibold text-neutral-500 bg-white border border-neutral-200 rounded">âŒ˜K</kbd>
        </button>

        <!-- Right Side Actions -->
        <div class="flex items-center space-x-4">
          <!-- Notifications -->
          <button
            class="p-2 rounded-lg hover:bg-neutral-100 transition-colors relative"
            aria-label="Notifications"
          >
            <svg
              class="w-5 h-5 text-neutral-600"
              fill="none"
              stroke="currentColor"
              viewBox="0 0 24 24"
            >
              <path
                stroke-linecap="round"
                stroke-linejoin="round"
                stroke-width="2"
                d="M15 17h5l-1.405-1.405A2.032 2.032 0 0118 14.158V11a6.002 6.002 0 00-4-5.659V5a2 2 0 10-4 0v.341C7.67 6.165 6 8.388 6 11v3.159c0 .538-.214 1.055-.595 1.436L4 17h5m6 0v1a3 3 0 11-6 0v-1m6 0H9"
              />
            </svg>
            <span class="absolute top-1 right-1 w-2 h-2 bg-destructive-500 rounded-full"></span>
          </button>

          <!-- User Menu -->
          <div class="relative">
            <button
              (click)="toggleUserMenu()"
              class="w-8 h-8 rounded-full bg-gradient-to-br from-primary-500 to-accent-500 flex items-center justify-center hover:ring-2 ring-primary-500 ring-offset-2 transition-all"
            >
              <span class="text-white text-sm font-medium">U</span>
            </button>

            <!-- Dropdown Menu -->
            @if (showUserMenu()) {
              <div class="absolute right-0 mt-2 w-56 bg-white rounded-xl shadow-soft-xl border border-neutral-200 py-2 animate-slide-up">
                <a href="#" class="block px-4 py-2 text-sm text-neutral-700 hover:bg-neutral-50">Profile</a>
                <a href="#" class="block px-4 py-2 text-sm text-neutral-700 hover:bg-neutral-50">Settings</a>
                <hr class="my-2 border-neutral-200">
                <a href="#" class="block px-4 py-2 text-sm text-destructive-600 hover:bg-destructive-50">Sign out</a>
              </div>
            }
          </div>
        </div>
      </div>
    </header>

    <!-- Page Content -->
    <main class="p-6">
      <router-outlet />
    </main>
  </div>

  <!-- Search Modal (CMD+K) -->
  @if (showSearchModal()) {
    <div
      class="fixed inset-0 z-50 flex items-start justify-center pt-20 px-4"
      (click)="closeSearch()"
    >
      <!-- Backdrop -->
      <div class="fixed inset-0 bg-neutral-900/50 backdrop-blur-sm"></div>

      <!-- Search Box -->
      <div
        class="relative w-full max-w-2xl bg-white rounded-2xl shadow-soft-2xl border border-neutral-200 animate-slide-up"
        (click)="$event.stopPropagation()"
      >
        <div class="flex items-center px-4 border-b border-neutral-200">
          <svg
            class="w-5 h-5 text-neutral-400 mr-3"
            fill="none"
            stroke="currentColor"
            viewBox="0 0 24 24"
          >
            <path
              stroke-linecap="round"
              stroke-linejoin="round"
              stroke-width="2"
              d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"
            />
          </svg>
          <input
            type="text"
            placeholder="Search..."
            class="flex-1 py-4 text-base focus:outline-none"
            autofocus
          />
        </div>
        <div class="p-4 text-sm text-neutral-500">
          <p>Type to search across projects, tasks, invoices, and more...</p>
        </div>
      </div>
    </div>
  }
</div>
